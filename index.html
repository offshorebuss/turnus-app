<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Turnus Calendar</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <div id="error" style="display:none;color:red;text-align:center;padding:20px;">
    Error: Could not render the application. Check the console for details.
  </div>

  <script src="https://cdn.jsdelivr.net/npm/react@18.3.1/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.3.1/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.25.6/babel.min.js"></script>

  <script type="text/babel">
    try {
      const { useState } = React;
      const { createRoot } = ReactDOM;

      function CalendarApp() {
        const [currentDate, setCurrentDate] = useState(new Date());
        const [startDate, setStartDate] = useState(new Date('2025-01-01'));

        const isWorkDay = (date) => {
          const diffTime = date - startDate;
          const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
          const cycleDay = diffDays % 56;
          return cycleDay >= 0 && cycleDay < 28;
        };

        const handleStartDateChange = (e) => {
          const newDate = new Date(e.target.value);
          if (!isNaN(newDate)) {
            setStartDate(newDate);
          }
        };

        const getDaysInMonth = () => {
          const year = currentDate.getFullYear();
          const month = currentDate.getMonth();
          const firstDay = new Date(year, month, 1);
          const lastDay = new Date(year, month + 1, 0);
          const days = [];

          const firstWeekday = firstDay.getDay();
          for (let i = 0; i < firstWeekday; i++) {
            days.push(null);
          }

          for (let day = 1; day <= lastDay.getDate(); day++) {
            days.push(new Date(year, month, day));
          }

          return days;
        };

        const prevMonth = () => {
          setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
        };

        const nextMonth = () => {
          setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));
        };

        const days = getDaysInMonth();
        const monthName = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' });

        return (
          <div className="min-h-screen bg-gray-100 flex items-center justify-center">
            <div className="bg-white p-6 rounded-lg shadow-lg w-full max-w-2xl">
              <h1 className="text-2xl font-bold mb-4 text-center">Turnus Calendar</h1>
              <div className="mb-4">
                <label className="block text-sm font-medium mb-1">Start Date for Work Cycle:</label>
                <input
                  type="date"
                  defaultValue="2025-01-01"
                  onChange={handleStartDateChange}
                  className="p-2 border rounded-lg w-full max-w-xs"
                />
              </div>
              <div className="flex justify-between mb-4">
                <button
                  onClick={prevMonth}
                  className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                >
                  Previous
                </button>
                <h2 className="text-xl font-semibold">{monthName}</h2>
                <button
                  onClick={nextMonth}
                  className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                >
                  Next
                </button>
              </div>
              <div className="grid grid-cols-7 gap-2 text-center">
                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day) => (
                  <div key={day} className="font-semibold">
                    {day}
                  </div>
                ))}
                {days.map((day, index) => (
                  <div
                    key={index}
                    className={`p-2 rounded-lg ${
                      day
                        ? isWorkDay(day)
                          ? 'bg-green-200 hover:bg-green-300'
                          : 'bg-red-200 hover:bg-red-300'
                        : 'bg-gray-100'
                    }`}
                  >
                    {day ? day.getDate() : ''}
                  </div>
                ))}
              </div>
              <div className="mt-4 text-center">
                <p>
                  <span className="inline-block w-4 h-4 bg-green-200 mr-2"></span>Work Days
                  <span className="inline-block w-4 h-4 bg-red-200 ml-4 mr-2"></span>Free Days
                </p>
              </div>
            </div>
          </div>
        );
      }

      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Root element not found");
      }
      const root = createRoot(rootElement);
      root.render(<CalendarApp />);
    } catch (e) {
      console.error('Error rendering app:', e);
      document.getElementById('error').style.display = 'block';
    }
  </script>
</body>
</html>
